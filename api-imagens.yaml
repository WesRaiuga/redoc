openapi: 3.0.0
info:
  version: "1.0.0"
  title: API SCCON
  description: >-
    # Introdução

    Essa API fornece acesso ao serviço de seleção automática das melhores imagens, retornando os IDs para download.
    O serviço é autenticado, ou seja, necessita de um token de segurança para ser acessado.
    A obtenção deste token de segurança é realizada através do serviço de autenticação.


    **Como usar autenticação JWT**<br/>
    Adicionar header com:<br/>
    - Chave: 'Authorization'<br/>
    - Valor : Bearer {access_token}'

  contact:
    email: plataforma@sccon.com.br

tags:
  - name: Token
    description: Fornece o token de acesso para utilizar o serviço de busca de imagens.
  - name: Melhores Imagens
    description: Busca das melhores imagens. No retorno há a propriedade "ids", contendo os IDs das imagens, que deverão ser extraídos, tratados e usados no script de download.
x-tagGroups:
  - name: Autenticação
    tags:
      - Token
  - name: Imagens
    tags:
      - Melhores Imagens
security:
  - JWT Token: []
paths:
  /auth/token:
    get:
      tags:
        - Token
      summary: Acesso ao token
      security: []
      parameters:
        - name: username
          in: query
          required: true
          schema:
            type: string
        - name: password
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Sucesso
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Token"
              examples:
                response:
                  value:
                    - access_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnYW1hYWdyaWN1bHR1cmEuY29tLmJyIiwic3ViIjoid2VzbGV5LnNpbHZhQHNjY29uLmNvbS5iciIsIm5hbWUiOiJXZXNsZXkgU2lsdmEiLCJleHAiOjE1OTg5MDQ3OTQ0NTAsImlhdCI6MTU5ODI5OTk5NDQ1MCwicm9sZXMiOlsiTUFOQUdFX1VTRVJTIiwiR0VORVJBVEVfV01TX1NFTEVDVEVEX0lNQUdFUyIsIkRPV05MT0FEX0lNQUdFX0FOQUxZVElDX1NSIiwiTUFOQUdFX09SR0FOSVpBVElPTlMiLCJHRVRfTU9TQUlDX0xJTksiLCJWSUVXIiwiRE9XTkxPQURfSU1BR0VfVklTVUFMIiwiRVhQRVJUX1BGIiwiRE9XTkxPQURfU1RBVFMiLCJET1dOTE9BRF9SQUFfU0hFRVQiLCJET1dOTE9BRF9JTUFHRV9TSEFQRSIsIkFDQ0VTU19EQVNIQk9BUkRfUEYiLCJET1dOTE9BRF9BTEVSVFMiLCJET1dOTE9BRCIsIk1BTkFHRV9DT05UUkFDVFMiLCJET1dOTE9BRF9JTUFHRV9BTkFMWVRJQyIsIkFVVE9NQVRJQ19XTVMiXX0.kpAJYGTXpWrV_QEnVUvC9soKojw-mLKmnVRsh8itst4
                      token_type: Bearer
                      iss: plataforma.sccon.com.br
                      sub: plataforma@sccon.com.br
                      name: Usuário do Serviço
                      exp: 1498742285823
                      iat: 1498655885823
                      roles:
                        - Download
                        - Search
        "401":
          description: Não autorizado
  /assets/best:
    post:
      tags:
        - Melhores Imagens
      summary: Buscar
      parameters:
        - name: byClouds
          in: query
          description: Usado para informar se a busca será feita usando o parâmetro de nuvens.
          schema:
            type: boolean
            default: false
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SceneFilterDTO"
      responses:
        "200":
          description: "Sucesso"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BestFeaturesDTO"
        "400":
          description: Solicitação inválida
        "401":
          description: Não autorizado
        "403":
          description: Proibido
servers:
  - url: https://plataforma.sccon.com.br/gama-api
components:
  securitySchemes:
    JWT Token:
      type: http
      scheme: bearer
      bearerFormat: JWT
  requestBodies:
    Token:
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Token"
      required: true
  schemas:
    SceneFilterDTO:
      title: Filtros Imagens
      type: object
      required:
        - sort
        - pageSize
        - permissions
        - providers
      properties:
        sort:
          type: string
          description: Ordenação do resultado
        pageSize:
          type: integer
        providers:
          $ref: "#/components/schemas/Providers"
        startAcquiredDate:
          type: string
          description: Valor inicial para pesquisa por data de aquisição da imagem.
        endAcquiredDate:
          type: string
          description: Valor final para pesquisa por data de aquisição da imagem.
        wkts:
          type: array
          description: Geometria para usar como busca.
          items:
            type: string
        startCloudCover:
          type: number
          description: Valor inicial para pesquisa por porcentagem de preechimento por nuvem. Valores entre 0 e 1
        endCloudCover:
          type: number
          description: Valor final para pesquisa por porcentagem de preechimento por nuvem. Valores entre 0 e 1
        startBlackFill:
          type: number
          description: Valor inicial para pesquisa por porcentagem da imagem com preenchimento de bit do tipo black fill. Valores entre 0 e 1
        endBlackFill:
          type: number
          description: Valor final para pesquisa por porcentagem da imagem com preenchimento de bit do tipo black fill. Valores entre 0 e 1
        satelliteId:
          type: string
        startGSD:
          type: number
          description: Valor inicial para pesquisa por porcentagem de Ground Sample Distance. Valores entre 0 e 1
        endGSD:
          type: number
          description: Valor final para pesquisa por porcentagem de Ground Sample Distance. Valores entre 0 e 1
        stripId:
          type: string
          description: Id da faixa de passagem
        onlySSO:
          type: boolean
          description: Apenas satélites de órbita heliossíncrona
        ids:
          type: array
          items:
            type: string
      example:
        permissions:
          - assets.analytic:download
        sort: "acquired desc"
        pageSize: 20
        providers:
          - PSScene4Band
        startAcquiredDate: 2019-06-21T00:00:00.000Z
        endAcquiredDate: 2019-07-31T23:59:59.999Z
        wkts:
          - POLYGON((-47.819366455078125 -22.85719470096962,-47.37510681152344 -22.85719470096962,-47.37510681152344 -22.576608430159975,-47.819366455078125 -22.576608430159975,-47.819366455078125 -22.85719470096962))
        startCloudCover: 0.0
        endCloudCover: 1.0
        startBlackFill: 0.0
        endBlackFill: 1.0
    Providers:
      title: Fornecedor Imagem
      type: array
      enum:
        - PSScene4Band
    BestFeaturesDTO:
      title: Features
      type: object
      properties:
        area:
          type: number
        areaCovered:
          type: number
        percentCovered:
          type: number
        ids:
          type: array
          description: IDs das imagens que serão usados para download
          items:
            type: string
        features:
          type: array
          items:
            $ref: "#/components/schemas/FeatureDTO"
        geometry:
          type: object
          description: Geometria em GeoJson
        geometryCovered:
          type: object
          description: Geometria em GeoJson
      example:
        area: 1419531335.5699923
        areaCovered: 1050088436.7985018
        percentCovered: 0
        ids:
          - '20190729_125803_1020'
          - '20190729_125802_1020'
          - '20190729_125801_1020'
          - '20190728_130120_0f32'
          - '20190728_130119_0f32'
          - '20190728_130118_0f32'
          - '20190728_130117_0f32'
          - '20190728_130116_0f32'
          - '20190728_130115_0f32'
          - '20190728_125810_0f36'
          - '20190728_125808_0f36'
          - '20190724_125158_0e16'
          - '20190724_125156_0e16'
          - '20190724_125155_0e16'
          - '20190720_130007_0f31'
        features:
          - id: "20190729_125803_1020"
            properties:
              acquired: "2019-07-29T12:58:03.930Z"
              cloudCover:  0.0
              itemType:  "PSScene4Band"
            geometryClip: {"type":"Polygon","coordinates":[[[-47.57112755227639,-22.583221251638346],[-47.56971842535617,-22.576608430159975],[-47.53408281335507,-22.576608430159975],[-47.57112755227639,-22.583221251638346]]]}
        geometry: {"type":"Polygon","coordinates":[[[-47.534215967937214,-22.50665272487075],[-47.38293114545644,-22.479688022103506],[-47.3687138901905,-22.547088579330943],[-47.39381525407846,-22.551569400173204],[-47.392950470219645,-22.555815215460612],[-47.39255816645839,-22.555745313722195],[-47.392483432806486,-22.55611102641119],[-47.19001111043079,-22.52020596339858],[-47.18538565159568,-22.542841403186635],[-47.18541124779766,-22.542845994031865],[-47.17585341012451,-22.589587739326742],[-47.27605730830451,-22.607447103263482],[-47.17491612489579,-22.626164097840192],[-47.178291345495964,-22.64163456896766],[-47.17760601336919,-22.64176243390583],[-47.19069850082108,-22.701502840177124],[-47.19162518833392,-22.705731271841245],[-47.190719740190424,-22.7059000530092],[-47.194346893228975,-22.722906848370716],[-47.2038234857121,-22.766148508004722],[-47.35565671535742,-22.73790042040271],[-47.35292125909303,-22.750872012230463],[-47.343870073304615,-22.75258182547447],[-47.347048112382666,-22.766978412629758],[-47.346848508423214,-22.767016017768345],[-47.348213664662346,-22.773195525218192],[-47.34478539024178,-22.78945247548862],[-47.35209183386003,-22.790750420959718],[-47.35276319852325,-22.79378941592526],[-47.21585588537255,-22.81908213881388],[-47.231912192117285,-22.894400081992362],[-47.368642061877054,-22.868982241009554],[-47.37374630679836,-22.892073175760935],[-47.49461615687577,-22.869319188553696],[-47.49679846558301,-22.879607029396613],[-47.5518303433007,-22.869416864135683],[-47.5499558548623,-22.878323860049974],[-47.637670200996645,-22.89420738159775],[-47.64308490689583,-22.91880107198525],[-47.70718177318698,-22.906794701726817],[-47.778741616323124,-22.91975292761004],[-47.779771733335295,-22.91494054855673],[-47.78445480556092,-22.892320224402773],[-47.89208585543961,-22.872159203889264],[-47.88692799759543,-22.84831374311329],[-47.8777105740874,-22.806920995896427],[-47.877959577637334,-22.806874353952665],[-47.86345271229636,-22.741702651895075],[-47.863868869341566,-22.741624674528428],[-47.84943367818,-22.67657245363594],[-47.85004902761253,-22.67645718105414],[-47.83997046124608,-22.63106281868576],[-47.842180953225785,-22.620352700808866],[-47.842513534813605,-22.620412862315455],[-47.856649368499234,-22.552097928999345],[-47.82134676525836,-22.54565756508838],[-47.8196159765766,-22.537629252682258],[-47.808353560834604,-22.485388217726907],[-47.808171848464276,-22.485422301683457],[-47.805319575619095,-22.472257772132977],[-47.694268614610664,-22.493136901732097],[-47.69051973006932,-22.47662859469047],[-47.534215967937214,-22.50665272487075]]]}
        geometryCovered: {"type":"MultiPolygon","coordinates":[[[[-47.8056583107871,-22.791722005443912],[-47.80390463230503,-22.80026007229713],[-47.57570406638306,-22.758945278304154],[-47.58652771240186,-22.706742611167513],[-47.37510681152344,-22.74668105291775],[-47.37510681152344,-22.78966158083056],[-47.37510681152344,-22.85719470096962],[-47.43205062657529,-22.85719470096962],[-47.49204424939493,-22.85719470096962],[-47.55440251283659,-22.85719470096962],[-47.56011514036351,-22.83005004165898],[-47.56006717229492,-22.830041425965653],[-47.562544483272234,-22.818557703438696],[-47.775747435589636,-22.85719470096962],[-47.79167740621678,-22.85719470096962],[-47.819366455078125,-22.85719470096962],[-47.819366455078125,-22.809111885603993],[-47.819366455078125,-22.74118587163138],[-47.819366455078125,-22.728783915058205],[-47.81698337878313,-22.740315735546847],[-47.816244396226246,-22.74018193916781],[-47.815904661169476,-22.741835994148072],[-47.8056583107871,-22.791722005443912]],[[-47.79167740621678,-22.85719470096962],[-47.795033847828805,-22.84150827965549],[-47.79291539916258,-22.851408907210484],[-47.79167740621678,-22.85719470096962]],[[-47.57064140379868,-22.781043092505072],[-47.56251213014355,-22.818551840350313],[-47.56892014933419,-22.788985019720833],[-47.57064140379868,-22.781043092505072]]],[[[-47.37510681152344,-22.656213077603617],[-47.37510681152344,-22.734281792111336],[-47.37510681152344,-22.73481971101209],[-47.37510681152344,-22.74668105291775],[-47.40741797693391,-22.740577315811972],[-47.56848883852177,-22.710150242630185],[-47.58652771240186,-22.706742611167513],[-47.5871047008799,-22.703959783882837],[-47.58750592859302,-22.704032378168243],[-47.58857295275779,-22.69896091918273],[-47.58857752055903,-22.698939208880915],[-47.5901107303701,-22.691652016210174],[-47.590380321465844,-22.690370676733473],[-47.5923019979063,-22.68123714108083],[-47.59954427417156,-22.64681532735473],[-47.600110787159494,-22.64412274786318],[-47.60039975490927,-22.644174996558455],[-47.60145837009894,-22.639103464294173],[-47.819366455078125,-22.678527519524984],[-47.819366455078125,-22.616225729771102],[-47.819366455078125,-22.576608430159975],[-47.615275918525114,-22.576608430159975],[-47.61527591852511,-22.576608430159975],[-47.612075661479764,-22.576608430159975],[-47.56971842535617,-22.576608430159975],[-47.57309986005552,-22.592476996494753],[-47.57112755227639,-22.583221251638346],[-47.56101468671378,-22.581416013524986],[-47.535891989386954,-22.576931384470633],[-47.53408281335507,-22.576608430159975],[-47.458912813819445,-22.576608430159975],[-47.388294773558705,-22.576608430159975],[-47.37510681152344,-22.576608430159975],[-47.37510681152344,-22.58911719103492],[-47.37510681152344,-22.656213077603617]],[[-47.60145837009894,-22.639103464294173],[-47.60284750471632,-22.63244850496596],[-47.60327872917274,-22.630382627992713],[-47.61131248700844,-22.59189511858927],[-47.60145837009894,-22.639103464294173]],[[-47.56879614051709,-22.612995951203967],[-47.56782155082306,-22.60846588239313],[-47.57421956579862,-22.638205010838348],[-47.56879614051709,-22.612995951203967]],[[-47.57421956579862,-22.638205010838348],[-47.583065945546025,-22.639780581562967],[-47.56132014196306,-22.63590757899164],[-47.57421956579862,-22.638205010838348]],[[-47.4621695040085,-22.591095236123124],[-47.464193408622485,-22.600098215138207],[-47.46327101632067,-22.595995117354093],[-47.4621695040085,-22.591095236123124]],[[-47.44437568430953,-22.67378539063355],[-47.446958916368736,-22.68551776385096],[-47.449608518426004,-22.697551572467855],[-47.44437568430953,-22.67378539063355]]],[[[-47.57112755227639,-22.583221251638346],[-47.56971842535617,-22.576608430159975],[-47.53408281335507,-22.576608430159975],[-47.57112755227639,-22.583221251638346]]]]}
    FeatureDTO:
      title: Feature
      type: object
      properties:
        links:
          $ref: "#/components/schemas/LinksDTO"
        permissions:
          type: array
          description: Downloads permitidos para a imagem
          items:
            type: string
        id:
          type: string
        "type":
          type: string
        properties:
          $ref: "#/components/schemas/FeaturePropertiesDTO"
        geometry:
          type: object
        geometryClip:
          type: object
        enableDownload:
          type: boolean
          description: Se a imagem permite download
    LinksDTO:
      title: Links
      type: object
      properties:
        thumbnail:
          type: string
        tms:
          type: string
        first:
          type: string
        next:
          type: string
        prev:
          type: string
        self:
          type: string
        assets:
          type: string
        activate:
          type: string
    FeaturePropertiesDTO:
      title: Properties
      type: object
      properties:
        acquired:
          type: string
        anomalousPixels:
          type: number
        blackFill:
          type: number
        cloudCover:
          type: number
        columns:
          type: integer
        epsgCode:
          type: integer
        gridCell:
          type: integer
        gsd:
          type: number
        instrument:
          type: string
        itemType:
          type: string
        originX:
          type: number
        originY:
          type: number
        pixelResolution:
          type: number
        provider:
          type: string
        published:
          type: string
        rows:
          type: integer
        satelliteId:
          type: string
        sunAzimuth:
          type: number
        sunElevation:
          type: number
        updated:
          type: string
        usableData:
          type: number
        viewAngle:
          type: number
        stripId:
          type: string
    Token:
      title: Token
      type: object
      properties:
        access_token:
          type: string
          readOnly: true
        token_type:
          type: string
          readOnly: true
        iss:
          type: string
          readOnly: true
        sub:
          type: string
          readOnly: true
        name:
          type: string
          readOnly: true
        exp:
          type: number
          readOnly: true
        iat:
          type: number
          readOnly: true
        roles:
          type: array
          enum:
            - Download
            - Search
          description: Permissões do usuário autenticado
          